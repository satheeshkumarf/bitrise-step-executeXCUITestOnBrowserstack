#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  executeXCUITestOnBrowserstack
summary: |
  Execute XCUITests on Browserstack Platform with retry logic
description: |
  This step will help you to execute ios Automation Tests XCUITests on Browserstack platform. Automatically manages device queue and retries failed tests based on the configured value also reports test status.
website: https://github.com/satheeshkumarf/bitrise-step-executexcuitestonbrowserstack
source_code_url: https://github.com/satheeshkumarf/bitrise-step-executexcuitestonbrowserstack
support_url: https://github.com/satheeshkumarf/bitrise-step-executexcuitestonbrowserstack/issues
host_os_tags:
  - osx-10.10
  - ubuntu-16.04

# If this step should be available only for certain project types
# just uncomment this `project_type_tags` section and include all the
# project types supported by the step. If the step can be used for all
# project types then you can just remove this section.
# If no `project_type_tags` specified (or specified as an empty array)
# that means the step can be used for any project type.
# You can find more information about project type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
project_type_tags:
  - ios
  - macos
#   - android
#   - xamarin
#   - react-native
#   - cordova
#   - ionic

# Type tags are used for categorizing steps, for easier step discovery in Step Libraries.
# You can find more information about type tags in the Step Development Guideline:
# https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
type_tags:
  - utility

is_requires_admin_user: true
is_always_run: false
is_skippable: false
run_if: ""

deps:
  brew:
  - name: git
  - name: wget
  apt_get:
  - name: git
  - name: wget


toolkit:
  bash:
    entry_file: browserstack.sh


inputs:
  - BROWSERSTACK_APP_URL: 
    opts:
      title: "Browserstack IPA URL"
      summary: IPA URL of the APP uploaded to Browserstack Server. You can use browserstack-upload bitrise step to upload your ipa.
      is_expand: true
      is_required: true

  - TESTS_FIILE_PATH: 
    opts:
      title: "Test File Path"
      summary: Specifiy the path to file name which contains your test and device details. Use .txt file to specify your test name and device details separated by equal to sign.
      description: |
        Sample File format:
            SearchListingsTest/testXYZ=iPhone 6-11.2
            SearchFilterTest/testABC=iPhone XS-12.1

      is_expand: true
      is_required: true  

  - BROWSERSTACK_XCTEST_URL: 
    opts:
      title: "Specify the XCUITest url from browserstack"
      summary: Build your XCUITEST and publish it to Browserstack; Specify the test_url path returned from browserstack in this variable
      is_expand: true
      is_required: true

  - BROWSERSTACK_USERNAME: 
    opts:
      title: "Browserstack Username"
      is_expand: true
      is_required: true 

  - BROWSERSTACK_PASSWORD: 
    opts:
      title: "Browserstack Access Key"
      is_expand: true
      is_required: true

  - RETRY_COUNT: 0
    opts:
      title: "Retry count for failed tests"
      summary: By default retry count is set as zero, which will not re-execute faiiled tests. If you specify a value greater than zero, only the failed tests will be re-executed to see if the issue was a random flakiness.  
      is_expand: true
      is_required: true 

outputs:
  #- EXAMPLE_STEP_OUTPUT:
    #opts:
      #title: "Example Step Output"
      #summary: Summary. No more than 2-3 sentences.
      #description: |
      #  Description of this output.

      # Can be Markdown formatted text.
